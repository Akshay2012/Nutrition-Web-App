{% extends "home/base.html" %}

{% block content %}
<div>
{% if plan.description %}
<p>
    <strong>{{plan.description}}</strong> 
</p>
{% endif %}
</div>
<!-- <div>
    <button onclick="add_meal_item({{plan.meal}},{{plan.plan}})">Add meal item</button>
    
</div> -->
<div>
    <form action="{{ form_action }}"
      method="post"
      class="form-horizontal">
    {% csrf_token %}
    <!-- {{form.ingredient}} -->
    <input id="id_ingredient" name="ingredient" type="hidden">
    <div class="form-group ui-widget" id="form-id_ingredient_searchfield">
        <label for="id_ingredient_searchfield" class="col-md-3 control-label">
         Ingredient name
        </label>

        <div class="col-md-9">
            <input type="text"
                   id="id_ingredient_searchfield"
                   class="form-control"
                   value="{{suggestions}}">
            <div id="exercise_name"></div>
        </div>
    </div>
    <div class="form-group ui-widget" id="form-id_amount">
        <label for="id_amount" class="col-md-3 control-label">
         Amount
        </label>

        <div class="col-md-9">
            <input type="number"
                    name="amount" step="0.01"
                   id="id_amount"
                   class="form-control"
                   value="{{suggestions}}">
            <span class="help-block"></span>
        </div>
    </div>
    <div class="form-group ui-widget" id="form-weight_unit">
        <label for="id_weight_unit" class="col-md-3 control-label">
         Weight unit
        </label>

        <div class="col-md-9">
            <select class="form-control" id="id_weight_unit" name="weight_unit"><option value="" selected="selected">g</option></select>
            <span class="help-block"></span>
        </div>
    </div>
    <button type="button" onclick="add_meal_item({{plan.meal}},{{plan.plan}})">Add Item</button>
</form>
</div>
<table class="table table-bordered">
    <thead>
        <tr style="background: #E0E0E0;">
            <th> "Meal"</th>
            <th>"Contents"</th>
            <th class="align-right"> "Energy"</th>
            <th class="align-right"> "Protein"</th>
            <th class="align-right"> "Carbohydrates"</th>
            <th class="align-right"> "Fat"</th>
        </tr>
    </thead>
    <tbody>
    <tr>
        <td colspan="2"></td>
        <td class="align-right"> 'kcal'</td>
        <td class="align-right"> 'g' owner_user</td>
        <td class="align-right"> 'g' owner_user</td>
        <td class="align-right"> 'g' owner_user</td>
    </tr>
{% for meal in plan.meal_set.select_related %}
    {% for item in meal.mealitem_set.select_related %}
    <tr>
        {% ifchanged meal.pk %}
        <td rowspan="{{meal.mealitem_set.count}}">
            <strong>
              {{ forloop.parentloop.counter }}
            {% if meal.time %} &ndash; {{meal.time|time:"H:i"}}{% endif %}
            </strong>

           
        </td>
        {% endifchanged %}
        <td>
            {% if item.get_unit_type == MEALITEM_WEIGHT_GRAM %}{{ item.amount|floatformat:"0" }}g
            {% else %}
                {{ item.amount|floatformat:"0" }} Ã— {{ item.weight_unit.unit.name }}
            {% endif %}
            {{ item.ingredient.name }}

            {% if is_owner %}
            <span class="editoptions">
                <a href="{% url 'nutrition:meal_item:delete' item.id %}"
                   title=" 'Delete' %}"
                   class="delete-mealitem">
                   <span class=""></span></a>
                <a href="{% url 'nutrition:meal_item:edit' item.id %}"
                   title=" 'Edit' %}"
                   class="wger-modal-dialog edit-meal edit-mealitem">
                    <span class=""></span></a>
            </span>
            {% endif %}
            </td>
            <td class="align-right">{{item.get_nutritional_values.energy|floatformat}}</td>
            <td class="align-right">{{item.get_nutritional_values.protein|floatformat}}</td>
            <td class="align-right">{{item.get_nutritional_values.carbohydrates|floatformat}}</td>
            <td class="align-right">{{item.get_nutritional_values.fat|floatformat}}</td>
</tr>
    {% empty %}
    {% if is_owner %}
    <tr>
        <td colspan="7">
           <a href="{% url 'nutrition:meal_item:add' meal.id %}"
              title=" 'Add one now.' %}"
              class="wger-modal-dialog edit-meal btn btn-default btn-block">
                 "No items for this meal." %}
                 "Add one now."%}
            </a>
        </td>
    </tr>
    {% endif %}
    {% endfor %}

{% empty %}
{% if is_owner %}
<p>
     <a href="{% url 'nutrition:meal:add' plan.id %}"
        class="wger-modal-dialog btn btn-default btn-block">
             "No meals for this plan." %}
             "Add one now." %}
        </a>
</p>
{% endif %}
{% endfor %}
        {% if is_owner %}
        <tr>
            <td colspan="6">
            <a href="{% url 'nutrition:meal:add' plan.id %}"
               class="wger-modal-dialog">
                <span class=""></span>
                 "Add a new meal" %}
            </a>
            </td>
        <tr>
        {% endif %}
    </tbody>
</table>

<h4> "Nutritional data" %}</h4>
{% if weight_entry %}
    <h5> Based on the weight entry dated {{date}} ({{weight}})</h5>
{% endif %}
<table class="table table-condensed">
    <thead>
        <tr>
            <th> "Macronutrients" </th>
            <th class="align-right"> "Total" </th>
            <th class="align-right"> "Percent of energy"</th>
            <th class="align-right">
                {% if owner_user.userprofile.use_metric %}
                     "g per body kg" %}
                {% else %}
                     "oz per body lb" %}
                {% endif %}
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td> "Energy" </td>
            <td class="align-right">{{nutritional_data.total.energy|floatformat}} </td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td> "Protein" </td>
            <td class="align-right">{{nutritional_data.total.protein|floatformat}} </td>
            <td class="align-right">{{nutritional_data.percent.protein|floatformat}} </td>
            <td class="align-right">{{nutritional_data.per_kg.protein|floatformat:2}}</td>
        </tr>
        <tr>
            <td> "Carbohydrates" %}</td>
            <td class="align-right">{{nutritional_data.total.carbohydrates|floatformat}} </td>
            <td class="align-right">{{nutritional_data.percent.carbohydrates|floatformat}} </td>
            <td class="align-right">{{nutritional_data.per_kg.carbohydrates|floatformat:2}}</td>
        </tr>
        <tr>
            <td style="padding-left: 2em;"> "Sugar content in carbohydrates" </td>
            <td class="align-right">{{nutritional_data.total.carbohydrates_sugar|floatformat}} </td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td> "Fat" %}</td>
            <td class="align-right">{{nutritional_data.total.fat|floatformat}} </td>
            <td class="align-right">{{nutritional_data.percent.fat|floatformat}} </td>
            <td class="align-right">{{nutritional_data.per_kg.fat|floatformat:2}}</td>
        </tr>
        <tr>
            <td style="padding-left: 2em;"> "Saturated fat content in fats" </td>
            <td class="align-right">{{nutritional_data.total.fat_saturated|floatformat}} </td>
            <td></td>
            <td></td>
        </tr>


        <tr>
            <th colspan="4"> "Others" %}</th>
        </tr>
        <tr>
            <td> "Fibres" %}</td>
            <td class="align-right">{{nutritional_data.total.fibres|floatformat}} </td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td> "Sodium" %}</td>
            <td class="align-right">{{nutritional_data.total.sodium|floatformat}} </td>
            <td></td>
            <td></td>
        </tr>
    </tbody>
</table>
{% endblock %}


{#          #}
{# Side bar #}
{#          #}
{% block sidebar %}
<h4> "Energy" %}</h4>
<table class="table table-condensed" id="nutritional-data-energy">
    <thead>
        <tr>
            <th> "Energy" %}</th>
            <th class="align-right">{{nutritional_data.total.energy|floatformat}}  "kcal" </th>
        </tr>
    </thead>
    <tbody>

        {% if is_owner and owner_user.userprofile.calories and plan.has_goal_calories %}
        {% with total=plan.get_calories_approximation %}
        <tr style="background-color:{% if total == 1 %}#8ae234;{% elif total == 2 %}#fce94f;{% elif total == 3 %}#fcaf3e;{% elif total > 3 %}#ef2929;{% endif %}">
            <td> "Goal" %}</td>
            <td class="align-right">
                <strong>{{owner_user.userprofile.calories}}  "kcal" </strong></td>
        </tr>
        {% endwith %}
        {% endif %}
    </tbody>
</table>

{% if is_owner and plan.has_goal_calories %}
    <p>You have selected that this nutritional plan has a
    goal amount of calories. Use the calculator or enter the value yourself.
    </p>
{% endif %}


{% if language.short_name != 'en' and is_owner %}
    <p>
     "If you find the ingredient list too short, you might want to activate the preference to also show English ingredients." %}
    </p>
{% endif %}


{% endblock %}



{#         #}
{# Options #}
{#         #}
{% block options %}
<div class="btn-group">
    <button type="button" class="btn btn-primary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        <span class=""></span>
         "Options" 
    </button>
    <ul class="dropdown-menu">
        <li>
            <a href="{% url 'nutrition:plan:export-pdf' plan.id uid token %}" target="_blank">
                <span class=""></span>
                 "Download as PDF" 
            </a>
        </li>
        {% if is_owner %}
        <li>
            <a href="{% url 'nutrition:plan:edit' plan.id %}" class="wger-modal-dialog">
                <span class=""></span>
                 "Edit nutrition plan" 
            </a>
        </li>
        <li>
            <a href="{% url 'nutrition:plan:copy' plan.id %}">
                <span class=""></span>
                 "Make a copy of this nutrition plan" 
            </a>
        </li>
        <li role="separator" class="divider"></li>
        <li>
                <span class=""></span>
                 "Delete nutrition plan" 
            </a>
        </li>
        {% endif %}
    </ul>
</div>
{% endblock %}